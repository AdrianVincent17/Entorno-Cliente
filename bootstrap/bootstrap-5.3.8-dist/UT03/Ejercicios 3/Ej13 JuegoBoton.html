<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="ventanamodal.css">
    <title>Juego del boton</title>
    <style>
        #botonX {
            position: absolute;
            /**/
            border-radius: 80px;
            color: white;
            background-color: red;
            text-align: center;
            cursor: pointer;
            width: 80px;
            height: 80px;
            font-size: 30px;
            box-shadow: 1px 5px 5px black;
        }

        #marcador {
            background-color: #0099ff;
            color: white;
            font-weight: bold;
            font-size: 16px;
            border: 1px solid #0055aa;
            padding: 10px 15px;
            border-radius: 4px;
            display: inline-block;
            margin: 5px;

        }
    </style>
</head>

<body>

    <button id="botonX" onclick="sumarAcierto()">X</button>

    <div id="marcador">
        <div>Tiempo: <span id="tiempo">10</span></div>
        <div>Aciertos: <span id="resultados">0</span></div>
        <div>Record: <span id="record">0</span></div>
    </div>
    <div id="overlay">

        <div id="modal">

        </div>
    </div>

    <script>

        //--- constantes para la configuracion del juego -----
        const DURACION = 10;    // duracion de la partida
        const VELOCIDAD = 2000; // velocidad de movimiento del boton
        const CLAVE_RECORD = "recordjuego";   // clave para almacenar el record en localStorage

        //---- variables del juego -----
        let tiemporestante = parseFloat(DURACION);      // tiempo restante en la partida
        let aciertos = 0;                // numero de aciertos en la partida

        let intMovimiento = null;       // identificador del intervalo de movimiento del boton
        let intTiempo = null;           // identificador del intervalo de tiempo


        //---referencias a elementos del DOM -----
        const boton = document.getElementById("botonX");
        const success = document.getElementById("resultados");
        const time = document.getElementById("tiempo");
        const mejor = document.getElementById("record");

        function moverBoton() {

            //--- obtener dimensiones de la ventana ----
            const anchoVentana = window.innerWidth;
            const altoVentana = window.innerHeight;

            //--- obtener dimensiones del boton ----
            const anchoBoton = boton.offsetWidth;   //Ancho del boton
            const altoBoton = boton.offsetHeight;   //Alto del boton

            // Calcular posiciones aleatorias dentro de los limites visibles
            const x = Math.random() * (anchoVentana - anchoBoton);
            const y = Math.random() * (altoVentana - altoBoton);

            //aplicamos las coordenadas al boton
            boton.style.left = x + "px";
            boton.style.top = y + "px";


        }

        //funcion para obtener el record almacenado en localStorage
        function obtenerrecord() {

            //localStroge.getItem devuelve el valor asociado a la clave o null si no existe
            const recordguardado = localStorage.getItem(CLAVE_RECORD);

            //si existe devolvemos el valor parseado a entero,(porque se guarda como cadena)
            //si no hay record (null) devolvemos 0
            return recordguardado ? parseInt(recordguardado) : 0;
        }

        function sumarAcierto() {
            if (tiemporestante > 0) {
                aciertos++;
                success.textContent = aciertos;

            }

        }

        function iniciar() {

            // inicializar variables

            aciertos = 0;
            tiemporestante = DURACION;
            success.textContent = aciertos;
            time.textContent = tiemporestante;
            mejor.textContent = obtenerrecord();

            moverBoton();
            clearInterval(intMovimiento);
            clearInterval(intTiempo);
            intMovimiento = setInterval(moverBoton, VELOCIDAD);
            intTiempo = setInterval(actualizartiempo, 10);
        }

        function actualizartiempo() {
            tiemporestante = (tiemporestante - 0.01).toFixed(2);
            time.textContent = tiemporestante;
            if (tiemporestante <= 0) {
                finalizar();
                abrirmodal();
            }

        }

        function finalizar() {
            clearInterval(intMovimiento);
            clearInterval(intTiempo);
            boton.style.display = "none"; // ocultar el boton al finalizar

            //octener el record actual
            let recordactual = obtenerrecord();

            //si hay nuevo record, lo guardamos en localStorage
            if (aciertos > recordactual) {
                localStorage.setItem(CLAVE_RECORD, aciertos);
            }


        }


        function abrirmodal() {
            document.getElementById("overlay").style.display = "flex";

            //actualizar los resultados en el modal
            document.getElementById("modal").innerHTML =`<h2>Fin de la partida</h2>
            <p>Has conseguido: <span>${aciertos}</span> Aciertos</p>
            <p>Record: <span>${obtenerrecord()}</span></p>
            <button onclick="cerrarmodal()">Reiniciar partida</button>`
           
        }

        function modalinicio(){

            document.getElementById("overlay").style.display = "flex";
             //actualizar los resultados en el modal
            document.getElementById("modal").innerHTML =`<h2>Bienvenido/a</h2>
            <p>Este es el juego del boton</p>
            <button onclick="cerrarmodal()">Iniciar partida</button>`
        }

        function cerrarmodal(){
            document.getElementById("overlay").style.display="none";
            boton.style.display = "block"; // mostrar el boton al reiniciar
            iniciar();
        }


        modalinicio();
        
      


    </script>

</body>

</html>