<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Adivina el numero</title>
    <style>
        body {
            background-color: lightgrey;
            font-family: Arial, Helvetica, sans-serif;
            text-align: center;
            margin-bottom: 80px;
        }

        /*fondo que cubre la pantalla*/
        #overlay1,
        #overlay2 {
            position: fixed;
            inset: 0;
            display: none;
            justify-content: center;
            align-items: center;
            background-color: rgb(0, 0, 0, 0.6);
        }

        /*Caja modal*/

        #modalinicio,
        #modalfinal {
            background-color: white;
            color: black;
            border-radius: 10px;
            width: 320px;
            padding: 28px;
            text-align: center;
        }

        button {
            background-color: blue;
            color: white;
            border: none;
            border-radius: 6px;
            padding: 10px 16px;
            cursor: pointer;
            font-size: 16px;

        }

        button:hover {
            background-color: darkblue;
        }

        body>button {
            margin-top: 30px;
        }

        #resultado {
            background-color: lightgrey;
            border-radius: 8px;
            margin: 15px auto;
            align-items: center;
            justify-content: center;
            padding: 10px;
            border: none;
            width: 450px;

        }

        #contenedor {

            justify-content: center;
            align-items: center;
            margin: 250px auto;
            background-color: white;
            border-radius: 8px;
            width: 500px;
            height: auto;
            padding: 40px 20px;
            text-align: center;
        }

        input,
        button {
            padding: 10px;
            font-size: 16px;

            margin: 4px;
        }

        li {
            justify-content: center;
            border-radius: 5px;
            background-color: lightgray;
            list-style: none;
            width: 250px;
            align-items: center;
            padding: 10px;
            margin: 5px auto;

        }

        ul {
            justify-content: center;
            align-items: center;
            margin: 0 auto;
        }
    </style>

</head>

<body>
    <div id="overlay1">
        <div id="modalinicio">
            <h1>Adivina un numero</h1>
            <p>El juego consiste en adivinar un numero entreo 1 y 100</p>
            <p>Te daremos pistas si el numero es mayor o es menor</p>
            <p>¡Intenta adivinarlo en el menor numero de intentos</p>
            <button onclick="cerrarmodal()">Iniciar Juego</button>
        </div>
    </div>
    <div id="overlay2">
        <div id="modalfinal">
            <h1>¡Has acertado!</h1>
            <p>Intentos: <span id="intentosfinales"></span></p>
            <p>Record: <span id="recordfinal"></span></p>
            <p id="nuevorecord"></p>
            <button onclick="cerrarmodal()">Reiniciar Juego</button>
        </div>
    </div>

    <div id="contenedor">
        <h1>Adivina un numero</h1>
        <div><input type="number" min="1" max="100" placeholder="numero" id="numero" name="numero" focus>
            <button onclick="probar()">Probar</button>
        </div>

        <div id="resultado">Escribe un numero entre <b>1</b> y <b>100</b> y pulsa <b>Probar</b></div>
        <p>intento: <span id="intento">0</span> | Record: <span id="record">-</span></p>
        <p><b>Historial de intentos:</b></p>
        <ul id="lista"></ul>
    </div>

   <script>
        const CLAVE_RECORD = 'recordintentos';

        let intentos = 0;
        let numeroadivinar = numeroaleatorio();
        let item = document.getElementById("lista");
        let resultado = document.getElementById("resultado");
        let record = document.getElementById("record");
        let intento = document.getElementById("intento");
        let recordfinal = document.getElementById("recordfinal");
        let intentosfinales = document.getElementById("intentosfinales");
        let nuevoRecordTexto = document.getElementById("nuevorecord"); // Referencia al texto de nuevo record

        function añadirintento() {
            let inputElement = document.getElementById("numero");
            let intentofallido = inputElement.value;

            // Corrección: Validar que no esté vacío
            if (intentofallido === "" || intentofallido > 100 || intentofallido < 1) {
                return; // Salimos si no es válido
            } 
            
            let nuevoelemento = document.createElement('li');
            nuevoelemento.textContent = `Intento ${intentos}: ${intentofallido}`
            item.appendChild(nuevoelemento);
            
            inputElement.value = "";
        }

        function obtenerrecord() {
            const recordguardado = localStorage.getItem(CLAVE_RECORD);
            // Devolvemos el número o null si no existe
            return recordguardado ? parseInt(recordguardado) : "-";
        }

        // --- ESTA FUNCIÓN AHORA SE LLAMA "gestionarRecord" Y SE USA AL GANAR ---
        function gestionarRecord() {
            let recordActual = obtenerrecord();
            let esNuevoRecord = false;

            // Si no hay record (null) O si mis intentos son menores al record
            if (recordActual === null || intentos < recordActual) {
                localStorage.setItem(CLAVE_RECORD, intentos);
                esNuevoRecord = true;
                recordActual = intentos; // Actualizamos para mostrarlo
            }

            // Actualizamos la UI del modal final
            recordfinal.textContent = recordActual;
            
            if (esNuevoRecord) {
                nuevoRecordTexto.textContent = "¡NUEVO RÉCORD!";
                nuevoRecordTexto.style.color = "red";
                nuevoRecordTexto.style.fontWeight = "bold";
            } else {
                nuevoRecordTexto.textContent = "";
            }
            
            // Actualizamos el record en la pantalla principal también
            record.textContent = recordActual;
        }

        function iniciar() { mn
            intentos = 0;
            // Mostrar "-" si es null, o el numero si existe
            let rec = obtenerrecord();
            record.textContent = rec === null ? "-" : rec;
            
            document.getElementById("lista").textContent = "";
            intento.textContent = "0";
            resultado.innerHTML = `Escribe un numero entre <b>1</b> y <b>100</b> y pulsa <b>Probar</b>`;
            
            // IMPORTANTE: Generar nuevo número al reiniciar
            numeroadivinar = numeroaleatorio(); 
            console.log("Nuevo número secreto:", numeroadivinar);
        }

        function numeroaleatorio() {
            return Math.floor(Math.random() * 100) + 1;
        }

        function probar() {
            let entrada = parseInt(document.getElementById('numero').value); // Parsear a int
            
            if (isNaN(entrada) || entrada < 1 || entrada > 100) {
                resultado.innerHTML = "Error: Introduce un número válido entre 1 y 100";
                return;
            }

            intentos++;
            intento.textContent = intentos;
            
            añadirintento(); // Movemos esto antes de limpiar o ganar para que salga en la lista

            let mensaje = "";

            if (entrada > numeroadivinar) {
                mensaje = `El número secreto es MENOR que ${entrada}`;
            } else if (entrada < numeroadivinar) {
                mensaje = `El número secreto es MAYOR que ${entrada}`;
            } else {
                mensaje = "¡HAS ACERTADO!";
                // AQUÍ LLAMAMOS A LA GESTIÓN DEL RÉCORD
                gestionarRecord(); 
                modalfinal();
            }

            resultado.innerHTML = mensaje;
        }

        function modalinicio() {
            // Solo mostramos el modal, iniciar() ya se llama al cerrar este o al cargar
            document.getElementById("overlay1").style.display = "flex";
        }

        function modalfinal() {
            document.getElementById("overlay2").style.display = "flex";
            intentosfinales.textContent = intentos;
            // El record ya se actualizó en gestionarRecord()
        }

        function cerrarmodal() {
            document.getElementById("overlay1").style.display = "none";
            document.getElementById("overlay2").style.display = "none";
            
            // Si venimos del final (overlay2 estaba visible), reiniciamos el juego
            // Pero como esta función la usas para ambos botones, simplemente llamamos a iniciar
            // Ojo: Si cierras el modal de "Inicio", no deberías resetear todo de cero si ya cargó.
            // Para simplificar tu lógica actual:
            iniciar(); 
        }

        // Al cargar la página
        iniciar(); 
        modalinicio();

    </script>

</body>

</html>